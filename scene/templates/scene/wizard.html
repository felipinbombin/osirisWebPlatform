{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block extrahead %}
  {{ block.super }}
  <script type="text/javascript" src="{% url 'admin:jsi18n' %}"></script>
  {{ media }}
{% endblock %}

{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="{% static "admin/css/forms.css" %}" />
  {% with "components/gentelella/vendors/" as gentelella_static %}
    <link href="{% static gentelella_static|add:"dropzone/dist/min/dropzone.min.css" %}" rel="stylesheet" />
  {% endwith %}
  <link href="{% static "components/smartwizard/dist/css/smart_wizard.css" %}" rel="stylesheet" />
  <link href="{% static "components/smartwizard/dist/css/smart_wizard_theme_circles.css" %}" rel="stylesheet" />
  <link href="{% static "components/smartwizard/dist/css/smart_wizard_theme_dots.css" %}" rel="stylesheet" />
  <style>
    .sw-theme-dots .step-content {
      background-color: inherit;
    }
    .sw-theme-dots > ul.step-anchor > li.active > a {
      color: #34495E;
    }
    .sw-theme-dots > ul.step-anchor > li.done > a {
      color: #169F85;
    }
    .sw-theme-dots > ul.step-anchor > li.done > a:after {
      background: #169F85;
    }
    .sw-theme-dots > ul.step-anchor > li.active > a:after {
      background: #34495E;
    }
  </style>
{% endblock %}

{% block coltype %}colM{% endblock %}

{% block bodyclass %}
  {{ block.super }} app-{{ opts.app_label }} model-{{ opts.model_name }} change-form
{% endblock %}

{% block content %}
<div id="content-main" class="col-md-12 col-sm-12 col-xs-12">
  <div id="wizard">
    {% include 'scene/stepsHeader.html' %}
    <div>
    <div id="step-1" style="display: none">
      {% include 'scene/step1.html' %}
    </div>
    <div id="step-2" style="display: none">
      <div class="x_panel">
        <div class="x_title">
          <h2>Subir archivo topológico</h2>
          <div class="clearfix"></div>
        </div>
        <div class="x_content">
          <p>La estructura general del sistema de metro se ha generado. En este paso debe realizar las siguientes tareas:</p>
          <ul>
            <li>Descargar el archivo de detalle del sistema topológico (botón "Descargar plantilla Excel")</li>
            <li>Completar el archivo descargado en el paso anterior respetando la estructura que allí se presenta</li>
            <li>Una vez completado, arrastrar el archivo al cuadro de la derecha</li>
          </ul>
          <div class="col-md-6 col-sm-6 col-xs-12">
            <button type="button" class="btn btn-info btn-lg btn-block"><i class="fa fa-file-excel-o fa-5x"></i><br />Descargar plantilla<br />Excel</button>   
          </div>
          <div class="col-md-6 col-sm-6 col-xs-12">
            <form action='uploadTopologicFile' class="dropzone">
            </form>
          </div>
        </div>
      </div>
    </div>
    <div id="step-3" style="display: none">
      <div class="x_panel">
        <div class="x_title">
          <h2>Variables sistemicas globales</h2>
          <div class="clearfix"></div>
        </div>
        <div class="x_content">
        </div>
      </div>
    </div>
    <div id="step-4" style="display: none">
      <div class="x_panel">
        <div class="x_title">
          <h2>Subir archivo sistemico</h2>
          <div class="clearfix"></div>
        </div>
        <div class="x_content">
          <p>En este paso debe realizar las siguientes tareas:</p>
          <ul>
            <li>Descargar el archivo de detalle sistemico (botón "Descargar plantilla Excel")</li>
            <li>Completar el archivo descargado en el paso anterior respetando la estructura que allí se presenta</li>
            <li>Una vez completado, arrastrar el archivo al cuadro de la derecha</li>
          </ul>
          <div class="col-md-6 col-sm-6 col-xs-12">
            <button type="button" class="btn btn-info btn-lg btn-block"><i class="fa fa-file-excel-o fa-5x"></i><br />Descargar plantilla<br />Excel</button>   
          </div>
          <div class="col-md-6 col-sm-6 col-xs-12">
            <form action='uploadTopologicFile' class="dropzone">
            </form>
          </div>
        </div>
      </div>
    </div>
    <div id="step-5" style="display: none">
      <div class="x_panel">
        <div class="x_title">
          <h2>Variables operacionales globales</h2>
          <div class="clearfix"></div>
        </div>
        <div class="x_content">
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
           Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
          </p>
        </div>
      </div>
    </div>
    <div id="step-6" style="display: none">
      <div class="x_panel">
        <div class="x_title">
          <h2>Subir archivo operacional</h2>
          <div class="clearfix"></div>
        </div>
        <div class="x_content">
          <p>En este paso debe realizar las siguientes tareas:</p>
          <ul>
            <li>Descargar el archivo de detalle operacional (botón "Descargar plantilla Excel")</li>
            <li>Completar el archivo descargado en el paso anterior respetando la estructura que allí se presenta</li>
            <li>Una vez completado, arrastrar el archivo al cuadro de la derecha</li>
          </ul>
          <div class="col-md-6 col-sm-6 col-xs-12">
            <button type="button" class="btn btn-info btn-lg btn-block"><i class="fa fa-file-excel-o fa-5x"></i><br />Descargar plantilla<br />Excel</button>   
          </div>
          <div class="col-md-6 col-sm-6 col-xs-12">
            <form action='uploadTopologicFile' class="dropzone">
            </form>
          </div>
        </div>
      </div>
    </div>
    <div id="step-7" style="display: none">
      <div class="x_panel">
        <div class="x_title">
          <h2>Subir archivo de velocidades</h2>
          <div class="clearfix"></div>
        </div>
        <div class="x_content">
          <p>En este paso debe realizar las siguientes tareas:</p>
          <ul>
            <li>Descargar el archivo de detalle operacional (botón "Descargar plantilla Excel")</li>
            <li>Completar el archivo descargado en el paso anterior respetando la estructura que allí se presenta</li>
            <li>Una vez completado, arrastrar el archivo al cuadro de la derecha</li>
          </ul>
          <div class="col-md-6 col-sm-6 col-xs-12">
            <button type="button" class="btn btn-info btn-lg btn-block"><i class="fa fa-file-excel-o fa-5x"></i><br />Descargar plantilla<br />Excel</button>   
          </div>
          <div class="col-md-6 col-sm-6 col-xs-12">
            <form action='uploadTopologicFile' class="dropzone">
            </form>
          </div>
        </div>
      </div>
    </div>
    </div>
  </div>
</div>
{% endblock %}
{% block extrajs %}
  {% with "components/gentelella/vendors/" as gentelella_static %}
    <script src="{% static gentelella_static|add:"dropzone/dist/min/dropzone.min.js" %}"></script>
  {% endwith %}
    <script src="{% static "components/smartwizard/dist/js/jquery.smartWizard.min.js" %}"></script>
  <script src="{% static "components/knockout/dist/knockout.debug.js" %}"></script>
  <script>
  $(document).ready(function(){
    // set wizard
    $('#wizard').smartWizard({
      labelNext:'Siguiente', 
      labelPrevious:'Anterior',
      labelFinish:'Finalizar',  
      autoAdjustHeight: false,
      theme: 'dots',
      lang: {
        next: 'Siguiente',
        previous: 'Anterior',
      },
      toolbarSettings: {
        toolbarPosition: 'top',
      },
      toolbarExtraButtons: [
        $('<button></button>').text('Finalizar')
          .addClass('btn btn-success')
         .on('click', function(){ 
           alert('Finsih button click');                            
	 })
      ],
    });
   
    $('.buttonNext').addClass('btn btn-success');
    $('.buttonPrevious').addClass('btn btn-primary');
    $('.buttonFinish').addClass('btn btn-default');

    //init_sidebar();
    console.log({{ scene.lastSuccessfullStep }});

    /**************************************************
    * CUSTOM BINDING HANDLERS
    ***************************************************/
    ko.bindingHandlers.modal = {
      init: function(element, valueAccessor){
        $(element).modal({
            show: false
        });
        
        var value = valueAccessor();
        if(typeof value === 'function'){
          $(element).on('hide.bs.modal', function(){
            value(false);
          });
        }
        ko.utils.domNodeDisposal.addDisposeCallback(element, function(){
          $(element).modal("destroy");
        });
      },
      update: function (element, valueAccessor) {
        var value = valueAccessor();
        if (ko.utils.unwrapObservable(value)) {
          $(element).modal('show');
        } else {
          $(element).modal('hide');
        }
      }
    };
    /**************************************************
    * STEP 1
    ***************************************************/
    let Station = function(name){
      this.name = ko.observable(name);
    };
    let depot = function(){
      this.name = ko.observable(name);
    };
    let Line = function(name){
      let self = this;
      self.name = ko.observable(name);
      self.stations = ko.observableArray();
      self.depots = ko.observableArray();
      self.stationsQuantity = ko.computed(function() {
        return self.stations().length;
      });
    };
    let connection = function(name){
      this.name = ko.observable(name);
      this.stations = ko.observableArray();
    };
    let Step1ViewModel = function(){
      let self = this;

      self.lines = ko.observableArray();
      self.linesQuantity = ko.computed(function() {
        return self.lines().length;
      });
      self.connections = ko.observableArray();

      /**************************************************
      * FORM TO ADD LINE
      ***************************************************/
      self.showDialog = ko.observable(false);
      self.lineName = ko.observable(null);
      self.stationsQuantity = ko.observable(0);
      self.openAddLineForm = function(){
        const LINE_NAME_PREFIX = 'L';
        let defaultLineName = LINE_NAME_PREFIX + (self.lines().length + 1);
        self.lineName(defaultLineName);
        self.stationsQuantity(1);
        console.log(self.lineName());
        console.log(self.stationsQuantity());
        self.showDialog(true);
      };
      self.removeLine = function(){
        self.lines.remove(this);
      };
      self.addLine = function(){
        const STATION_NAME_PREFIX = 'S';
        let line = new Line(self.lineName());
        for(let i=0;i<self.stationsQuantity();i++){
          let stationName = STATION_NAME_PREFIX + (i + 1);
          let station = new Station(stationName);
          line.stations.push(station);
        }
        self.lines.push(line);
        self.showDialog(false);
        $("#wizard").smartWizard("fixHeight");
      }
      self.showStations = function(){
        
      }
    }
    ko.applyBindings(new Step1ViewModel(), document.getElementById('step-1'));
  });
  </script>
{% endblock %}
